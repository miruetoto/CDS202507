<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ˜ê°•ì‹ ì²­ ìˆ˜ìš”ì¡°ì‚¬ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="data.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }
        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-card .unit {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .filters {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .filter-group label {
            font-weight: bold;
            color: #333;
        }
        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .chart-container {
            margin-bottom: 40px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .chart-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
        }
        .footer p {
            margin: 5px 0;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 2em;
            }
            .filters {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ìˆ˜ê°•ì‹ ì²­ ìˆ˜ìš”ì¡°ì‚¬ ëŒ€ì‹œë³´ë“œ</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ì´ ì‘ë‹µì ìˆ˜</h3>
                <div class="number" id="totalStudents">-</div>
                <div class="unit">ëª…</div>
            </div>
            <div class="stat-card">
                <h3>ì´ ê³¼ëª© ìˆ˜</h3>
                <div class="number" id="totalSubjects">-</div>
                <div class="unit">ê³¼ëª©</div>
            </div>
            <div class="stat-card">
                <h3>ë³¸ì „ê³µ í•™ìƒ</h3>
                <div class="number" id="mainMajorStudents">-</div>
                <div class="unit">ëª…</div>
            </div>
            <div class="stat-card">
                <h3>í‰ê·  ì„ íƒ ê³¼ëª© ìˆ˜</h3>
                <div class="number" id="avgSubjects">-</div>
                <div class="unit">ê³¼ëª©</div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label for="majorFilter">ì „ê³µ êµ¬ë¶„:</label>
                <select id="majorFilter">
                    <option value="all">ì „ì²´</option>
                    <option value="ë³¸ì „ê³µ">ë³¸ì „ê³µ</option>
                    <option value="ë³µìˆ˜ì „ê³µ">ë³µìˆ˜ì „ê³µ</option>
                    <option value="ë¶€ì „ê³µ">ë¶€ì „ê³µ</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="gradeFilter">í•™ë…„:</label>
                <select id="gradeFilter">
                    <option value="all">ì „ì²´</option>
                    <option value="2">2í•™ë…„</option>
                    <option value="3">3í•™ë…„</option>
                    <option value="4">4í•™ë…„</option>
                </select>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">í•™ë…„ë³„ ì‘ë‹µì ë¶„í¬</div>
            <div id="gradeChart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-title">ì¸ê¸° ê³¼ëª© ìˆœìœ„ (ìƒìœ„ 20ê°œ)</div>
            <div id="popularSubjectsChart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-title">ê³¼ëª© êµ¬ë¶„ë³„ ì„ íƒ í˜„í™©</div>
            <div id="subjectTypeChart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-title">í•™ë…„ë³„ ê³¼ëª© ì„ íƒ íŒ¨í„´</div>
            <div id="gradeSubjectChart"></div>
        </div>

        <div class="footer">
            <p>ë°ì´í„° ê¸°ì¤€: 2025ë…„ 7ì›” ìˆ˜ê°•ì‹ ì²­ ìˆ˜ìš”ì¡°ì‚¬ | ìƒì„±ì¼: 2025-07-08</p>
        </div>
    </div>

    <script>
        // ë°ì´í„° ë¡œë“œ ë° íŒŒì‹±
        async function loadData() {
            try {
                // JavaScript íŒŒì¼ì˜ ë°ì´í„° ì‚¬ìš©
                const data = csvData.filter(row => {
                    // ì´ì„ íƒê³¼ëª©ìˆ˜ 8 ë¯¸ë§Œ í•„í„°ë§
                    return parseInt(row['ì´ì„ íƒê³¼ëª©ìˆ˜']) < 8;
                }).map(row => {
                    // í•™ë…„ ì •ë¦¬ ('4í•™ë…„' -> '4')
                    return {
                        ...row,
                        'í•™ë…„': row['í•™ë…„'].charAt(0),
                        'ê³¼ëª©í•™ë…„': row['ê³¼ëª©í•™ë…„'].charAt(0)
                    };
                });
                
                return data;
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì—ëŸ¬:', error);
                return [];
            }
        }

        // í†µê³„ ê³„ì‚°
        function calculateStats(data) {
            const uniqueStudents = [...new Set(data.map(row => row['í•™ìƒID']))];
            const uniqueSubjects = [...new Set(data.map(row => row['ê³¼ëª©ëª…']))];
            const mainMajorStudents = [...new Set(data.filter(row => row['ì „ê³µ'] === 'ë³¸ì „ê³µ').map(row => row['í•™ìƒID']))];
            
            const avgSubjects = uniqueStudents.reduce((acc, studentId) => {
                const studentData = data.find(row => row['í•™ìƒID'] === studentId);
                const count = parseInt(studentData['ì´ì„ íƒê³¼ëª©ìˆ˜']) || 0;
                return acc + count;
            }, 0) / uniqueStudents.length;

            return {
                totalStudents: uniqueStudents.length,
                totalSubjects: uniqueSubjects.length,
                mainMajorStudents: mainMajorStudents.length,
                avgSubjects: avgSubjects.toFixed(1)
            };
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(data) {
            const stats = calculateStats(data);
            document.getElementById('totalStudents').textContent = stats.totalStudents;
            document.getElementById('totalSubjects').textContent = stats.totalSubjects;
            document.getElementById('mainMajorStudents').textContent = stats.mainMajorStudents;
            document.getElementById('avgSubjects').textContent = stats.avgSubjects;
        }

        // ë°ì´í„° í•„í„°ë§
        function filterData(data, majorFilter, gradeFilter) {
            return data.filter(row => {
                const majorMatch = majorFilter === 'all' || row['ì „ê³µ'] === majorFilter;
                const gradeMatch = gradeFilter === 'all' || row['í•™ë…„'] === gradeFilter;
                return majorMatch && gradeMatch;
            });
        }

        // í•™ë…„ë³„ ì‘ë‹µì ë¶„í¬ ì°¨íŠ¸
        function createGradeChart(data) {
            const uniqueStudents = [...new Set(data.map(row => row['í•™ìƒID']))];
            const gradeCount = {};
            
            uniqueStudents.forEach(studentId => {
                const studentData = data.find(row => row['í•™ìƒID'] === studentId);
                const grade = studentData['í•™ë…„'];
                gradeCount[grade] = (gradeCount[grade] || 0) + 1;
            });

            const trace = {
                x: Object.keys(gradeCount).map(g => g + 'í•™ë…„'),
                y: Object.values(gradeCount),
                type: 'bar',
                marker: {
                    color: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4']
                }
            };

            const layout = {
                title: '',
                xaxis: { title: 'í•™ë…„' },
                yaxis: { title: 'ì‘ë‹µì ìˆ˜ (ëª…)' },
                font: { family: 'Arial', size: 12 }
            };

            Plotly.newPlot('gradeChart', [trace], layout);
        }

        // ì¸ê¸° ê³¼ëª© ìˆœìœ„ ì°¨íŠ¸
        function createPopularSubjectsChart(data) {
            const subjectCount = {};
            data.forEach(row => {
                const subject = row['ê³¼ëª©ëª…'];
                subjectCount[subject] = (subjectCount[subject] || 0) + 1;
            });

            const sorted = Object.entries(subjectCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);

            const trace = {
                x: sorted.map(item => item[1]),
                y: sorted.map(item => item[0]),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: '#667eea'
                }
            };

            const layout = {
                title: '',
                xaxis: { title: 'ì„ íƒ íšŸìˆ˜' },
                yaxis: { title: 'ê³¼ëª©ëª…' },
                font: { family: 'Arial', size: 12 },
                margin: { l: 150 }
            };

            Plotly.newPlot('popularSubjectsChart', [trace], layout);
        }

        // ê³¼ëª© êµ¬ë¶„ë³„ ì„ íƒ í˜„í™© ì°¨íŠ¸
        function createSubjectTypeChart(data) {
            const typeCount = {};
            data.forEach(row => {
                const type = row['êµ¬ë¶„'];
                typeCount[type] = (typeCount[type] || 0) + 1;
            });

            const trace = {
                labels: Object.keys(typeCount),
                values: Object.values(typeCount),
                type: 'pie',
                marker: {
                    colors: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4']
                }
            };

            const layout = {
                title: '',
                font: { family: 'Arial', size: 12 }
            };

            Plotly.newPlot('subjectTypeChart', [trace], layout);
        }

        // í•™ë…„ë³„ ê³¼ëª© ì„ íƒ íŒ¨í„´ ì°¨íŠ¸
        function createGradeSubjectChart(data) {
            const gradeSubjectCount = {};
            
            data.forEach(row => {
                const grade = row['í•™ë…„'] + 'í•™ë…„';
                const subjectGrade = row['ê³¼ëª©í•™ë…„'] + 'í•™ë…„ê³¼ëª©';
                
                if (!gradeSubjectCount[grade]) {
                    gradeSubjectCount[grade] = {};
                }
                gradeSubjectCount[grade][subjectGrade] = (gradeSubjectCount[grade][subjectGrade] || 0) + 1;
            });

            const traces = [];
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            let colorIndex = 0;

            Object.entries(gradeSubjectCount).forEach(([grade, subjects]) => {
                traces.push({
                    name: grade,
                    x: Object.keys(subjects),
                    y: Object.values(subjects),
                    type: 'bar',
                    marker: {
                        color: colors[colorIndex % colors.length]
                    }
                });
                colorIndex++;
            });

            const layout = {
                title: '',
                xaxis: { title: 'ê³¼ëª© í•™ë…„' },
                yaxis: { title: 'ì„ íƒ íšŸìˆ˜' },
                barmode: 'group',
                font: { family: 'Arial', size: 12 }
            };

            Plotly.newPlot('gradeSubjectChart', traces, layout);
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts(data) {
            createGradeChart(data);
            createPopularSubjectsChart(data);
            createSubjectTypeChart(data);
            createGradeSubjectChart(data);
        }

        // í•„í„° ì´ë²¤íŠ¸ ì²˜ë¦¬
        function setupFilters(originalData) {
            const majorFilter = document.getElementById('majorFilter');
            const gradeFilter = document.getElementById('gradeFilter');

            function updateDashboard() {
                const filteredData = filterData(originalData, majorFilter.value, gradeFilter.value);
                updateStats(filteredData);
                updateCharts(filteredData);
            }

            majorFilter.addEventListener('change', updateDashboard);
            gradeFilter.addEventListener('change', updateDashboard);
        }

        // ì´ˆê¸°í™”
        async function init() {
            const data = await loadData();
            updateStats(data);
            updateCharts(data);
            setupFilters(data);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>